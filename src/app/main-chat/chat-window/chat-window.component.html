<div class="chat-window">
  <app-chatwindow-loader [loading]="isLoading"></app-chatwindow-loader>
    <!-- Chat Header -->
  <div class="chat-window__header" >
    <div class="chat-header__info">
      <img [src]="chatAvatar || 'data:image/jpeg;base64,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'" 
      alt="Chat Avatar" class="chat-header__avatar">
      <div class="chat-header__details">
        <h2 class="chat-header__name">{{ chatName }}</h2>
        <p class="chat-header__status">{{ chatStatus }}</p>
      </div>
    </div>
    <!-- <div class="chat-header__actions">
      <button class="header-action__button" (click)="toggleOptions()">
        <i class="fas fa-ellipsis-v"></i>
      </button>
      <div *ngIf="showOptions" class="chat-header__dropdown">
        <button class="dropdown__item" (click)="goToSettings()">Settings</button>
        <button class="dropdown__item" (click)="exitChat()">Exit Chat</button>
      </div>
    </div> -->

    <div class="chat-header__actions">
      <!-- Audio Call Icon -->
      <button class="header-action__button" (click)="startAudioCall()">
        <i class="fas fa-phone"></i>
      </button>
      
      <!-- Video Call Icon -->
      <button class="header-action__button" (click)="startVideoCall()">
        <i class="fas fa-video"></i>
      </button>
    </div>
  </div>
  
  <!-- Messages Area -->
  <div class="chat-window__messages" #chatMessages *ngIf="!isLoading">
    <div *ngFor="let message of messages" 
         [ngClass]="{'message--incoming': message.sender._id !== currentUserId, 'message--outgoing': message.sender._id === currentUserId}" 
         class="chat-message">
      
      <!-- Incoming messages -->
      <div *ngIf="message.sender._id !== currentUserId" class="message__wrapper message__wrapper--left">
        <div class="message__avatar">
          <img [src]="message.sender?.profilePicture || 'assets/default-avatar.png'" alt="Sender Avatar" class="avatar">
        </div>
        <div class="message__content">
          <p class="message__sender-name">{{ message.sender?.username || 'Unknown' }}</p>
          <p class="message__text">{{ message.message }}</p>
          <span class="message__time">{{ message.createdAt | date:'shortTime' }}</span>
        </div>
      </div>

      <!-- Outgoing messages -->
      <div *ngIf="message.sender._id === currentUserId" class="message__wrapper message__wrapper--right">
        <div class="message__content">
          <p class="message__text">{{ message.message }}</p>
          <span class="message__time">{{ message.createdAt | date:'shortTime' }}</span>
        </div>
        <div class="message__avatar">
          <img [src]="currentUserAvatar || 'assets/default-avatar.png'" alt="Your Avatar" class="avatar">
        </div>
      </div>
    </div>
  </div>
</div>
